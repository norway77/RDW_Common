package org.opentestsystem.rdw.archive;

import org.junit.Ignore;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Import;
import org.springframework.core.env.Environment;
import org.springframework.test.context.TestPropertySource;
import org.springframework.test.context.junit4.SpringRunner;

import static org.assertj.core.api.Assertions.assertThat;

/**
 * This suite constructs multiple S3 archives to see if the separate amazon S3 clients
 * interfere with each other. Not really a test as much as a debugging aid ...
 */
@RunWith(SpringRunner.class)
@TestPropertySource(properties = {
        "archive.file.root=file://tmp",
        "archive[0].archive.aws.bucket=s3://BucketOne",
        "archive[0].archive.aws.accessKey: AccessKeyOne",
        "archive[0].cloud.aws.credentials.secretKey: SecretKeyOne",
        "archive[0].cloud.aws.region.static: us-west-2",
        "archive[1].archive.aws.bucket=s3://BucketTwo",
        "archive[1].cloud.aws.credentials.accessKey: AccessKeyTwo",
        "archive[1].cloud.aws.credentials.secretKey: SecretKeyTwo",
        "archive[1].cloud.aws.region.static: us-east-1"
})
public class MultiS3ArchiveServiceIT {

    @Test
    public void itShouldCreateSeparateClients() {
        ArchivePropertiesImpl archiveProperties = new ArchivePropertiesImpl(null, null);
        ArchiveService localArchiveService = new ArchiveServiceFacade().createArchiveService(archiveProperties);
        assertThat(localArchiveService.getRawUri("test").isEmpty()).isFalse() ;
        assertThat(localArchiveService.getRawUri("test").startsWith("file://")).isTrue();
        assertThat(localArchiveService.getRawUri("test").contains("test")).isTrue();
        //final ArchiveService serviceOne = factory.createArchiveService(env, "archive[0].");
        //final ArchiveService serviceTwo = factory.createArchiveService(env, "archive[1].");
        //System.out.println(serviceOne.toString());
       // System.out.println(serviceTwo.toString());
    }
}