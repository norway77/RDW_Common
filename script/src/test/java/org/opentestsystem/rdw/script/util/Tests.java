package org.opentestsystem.rdw.script.util;

import org.apache.commons.io.IOUtils;
import org.opentestsystem.rdw.script.PipelineScriptDefinition;
import org.opentestsystem.rdw.script.PipelineScriptType;
import org.opentestsystem.rdw.script.ScriptCompiler;
import org.opentestsystem.rdw.script.ScriptCompilers;

import java.io.IOException;
import java.io.InputStream;

import static java.nio.charset.StandardCharsets.UTF_8;

/**
 * Utilities used by some of the script tests.
 */
public final class Tests {

    public static InputStream resourceAsStream(final String path) {
        return Tests.class.getResourceAsStream(path);
    }

    public static byte[] resourceAsBytes(final String path) {
        try {
            return IOUtils.toByteArray(
                    resourceAsStream(path)
            );
        } catch (final IOException exception) {
            throw new RuntimeException(exception);
        }
    }

    public static String resourceAsString(final String path) {
        try {
            return IOUtils.toString(
                    resourceAsStream(path),
                    UTF_8
            );
        } catch (final IOException exception) {
            throw new RuntimeException(exception);
        }
    }

    public static final String baseScriptBody() {
        return resourceAsString("/DSLScriptBase.groovy");
    }

    public static final ScriptCompiler scriptCompilerWithBaseScript() {
        return ScriptCompilers.toScriptCompiler(baseScriptBody());
    }

    public static PipelineScriptDefinition baseScript() {
        return PipelineScriptDefinition.builder()
                .type(PipelineScriptType.Base)
                .body(baseScriptBody())
                .build();
    }

}
