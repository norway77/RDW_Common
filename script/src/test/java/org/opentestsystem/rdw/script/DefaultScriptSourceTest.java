package org.opentestsystem.rdw.script;

import org.assertj.core.api.Assertions;
import org.junit.Before;
import org.junit.Test;
import org.opentestsystem.rdw.script.impl.DefaultScriptSource;

import static org.assertj.core.api.Assertions.assertThat;

public class DefaultScriptSourceTest {

    private DefaultScriptSource scriptSource;

    @Before
    public void createScriptSource() {
        scriptSource = new DefaultScriptSource();
    }

    @Test
    public void itShouldLoadTheScriptBase() {
        assertThat(scriptSource.loadScriptBaseClass())
                .contains("DSLScriptBase")
                .contains("PipelineScript");
    }

    @Test
    public void itShouldLoadPipelineDefinition() {
        final PipelineDefinition pipelineDefinition =
                scriptSource.loadPipelineDefinition("test_pipeline", "1.0");
        assertThat(pipelineDefinition.getName()).isEqualTo("test_pipeline");
        assertThat(pipelineDefinition.getVersion()).isEqualTo("1.0");
    }

    @Test
    public void isShouldLoadScript() {
        final VersionedResource node = VersionedResource.builder()
                .name("exam_script")
                .version("")
                .type(ResourceType.USER_NODE)
                .build();
        Assertions.assertThat(scriptSource.loadScript(node).getCode()).startsWith("enable 'xml'");
    }
}
